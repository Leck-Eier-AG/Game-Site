---
phase: 02-core-game-engine
plan: 06
type: execute
wave: 3
depends_on: ["02-04"]
files_modified:
  - src/app/(app)/page.tsx
  - src/components/lobby/room-card.tsx
  - src/components/lobby/create-room-dialog.tsx
  - src/components/lobby/lobby-header.tsx
autonomous: true

must_haves:
  truths:
    - "User sees list of open rooms with player names and status"
    - "Room cards update in real-time as rooms are created/joined/left"
    - "User can create a new room with custom settings"
    - "User can join an existing room by clicking on it"
    - "Empty state shows helpful message when no rooms exist"
  artifacts:
    - path: "src/app/(app)/page.tsx"
      provides: "Lobby page replacing placeholder"
      min_lines: 30
    - path: "src/components/lobby/room-card.tsx"
      provides: "Individual room display card"
      exports: ["RoomCard"]
    - path: "src/components/lobby/create-room-dialog.tsx"
      provides: "Room creation dialog with settings form"
      exports: ["CreateRoomDialog"]
  key_links:
    - from: "src/app/(app)/page.tsx"
      to: "src/lib/socket/provider.tsx"
      via: "useSocket hook for real-time room list"
      pattern: "useSocket"
    - from: "src/components/lobby/create-room-dialog.tsx"
      to: "Socket.IO room:create"
      via: "socket.emit('room:create')"
      pattern: "room:create"
    - from: "src/components/lobby/room-card.tsx"
      to: "Socket.IO room:join"
      via: "socket.emit('room:join') on click"
      pattern: "room:join"
---

<objective>
Replace the lobby placeholder with a real-time room browsing and creation interface.

Purpose: The lobby is where players discover and join games. It needs to show available rooms in real-time (via Socket.IO) and let users create new rooms with host settings. This is the entry point for all game sessions.
Output: Functional lobby page with room cards, create room dialog, real-time updates via Socket.IO.
</objective>

<execution_context>
@C:\Users\maxi\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\maxi\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/02-core-game-engine/02-CONTEXT.md
@src/app/(app)/page.tsx
@src/lib/socket/provider.tsx
@src/types/game.ts
@src/messages/de.json
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build room card and lobby header components</name>
  <files>
    src/components/lobby/room-card.tsx
    src/components/lobby/lobby-header.tsx
  </files>
  <action>
Create src/components/lobby/room-card.tsx ('use client'):

A card component displaying room information from RoomInfo type:
- Room name as card title
- Game type badge (e.g., "Kniffel")
- Status badge with color: "Wartet" (green), "Laeuft" (yellow), "Beendet" (gray)
- Player list: show all player names (e.g., "Max, Anna, Tom")
- Player count: "{current}/{max} Spieler"
- Time since creation (e.g., "vor 5 Min.")
- Host name with small crown/star icon
- "Beitreten" button (disabled if room full or game in progress for non-spectators)
- Spectator indicator: if game in progress, button says "Zuschauen" instead

Use shadcn Card component for consistent styling. Dark theme with green accent matching app.

Props:
```typescript
interface RoomCardProps {
  room: RoomInfo
  onJoin: (roomId: string) => void
  currentUserId: string
}
```

Create src/components/lobby/lobby-header.tsx ('use client'):
- Title "Spielelobby" with gamepad icon
- Subtitle showing connection status and room count
- "Raum erstellen" button (triggers create dialog)
- Simple, clean header layout

Props:
```typescript
interface LobbyHeaderProps {
  roomCount: number
  onCreateRoom: () => void
}
```
  </action>
  <verify>
`npx tsc --noEmit` passes for lobby components.
Components export correctly.
  </verify>
  <done>
RoomCard displays room info with player names, status badges, join/spectate button.
LobbyHeader shows title, room count, create button.
  </done>
</task>

<task type="auto">
  <name>Task 2: Build create room dialog and wire lobby page</name>
  <files>
    src/components/lobby/create-room-dialog.tsx
    src/app/(app)/page.tsx
  </files>
  <action>
Create src/components/lobby/create-room-dialog.tsx ('use client'):

Dialog for creating a new game room with these fields:
- Room name (text input, required, 3-30 chars)
- Max players (select: 2, 3, 4, 5, 6 - default 4)
- Turn timer (select: 30s, 60s, 90s - default 60s)
- AFK threshold (number input: 1-10 rounds, default 3)
- Public/Private toggle (default public)

On submit:
1. Emit `socket.emit('room:create', { settings }, callback)`
2. On success (callback receives roomId), navigate to `/game/${roomId}`
3. On error, show toast via sonner

Use shadcn Dialog, Input, Label components. Use `useRouter()` from next/navigation for redirect.

Props:
```typescript
interface CreateRoomDialogProps {
  open: boolean
  onOpenChange: (open: boolean) => void
}
```

Replace src/app/(app)/page.tsx (currently placeholder):

Convert to a 'use client' component (needs useSocket for real-time updates). Actually, keep the page as a thin server component wrapper that renders a client component, following the existing (app) layout pattern. OR make it a client component directly since it needs socket interaction immediately.

Best approach: Make it 'use client' since the entire page is interactive (socket-driven).

Implementation:
1. Use `useSocket()` to get socket instance and connection status
2. On mount + on 'room:list-update' event, request room list via `socket.emit('room:list', callback)`
3. Store rooms in useState
4. Render LobbyHeader with room count and create button
5. Render grid of RoomCard components (responsive: 1 col mobile, 2 cols md, 3 cols lg)
6. Handle join: `socket.emit('room:join', { roomId }, callback)` then navigate to `/game/${roomId}`
7. Show empty state when no rooms: icon + "Keine offenen Raeume" message with "Erstelle einen Raum" prompt
8. Show loading state while fetching rooms
9. CreateRoomDialog controlled by state

Pass currentUserId to RoomCard. Get userId from socket.data or from a prop. Since the page is inside (app) layout which has session, pass userId down. However, the (app)/layout.tsx passes session to Sidebar, not to children. Two approaches:
- Option A: Create a UserContext in the (app) layout that children can consume
- Option B: Read userId from the socket instance after connection

Use Option B: After socket connects, the server has socket.data.userId, but the client doesn't directly have it. Store userId in the SocketProvider context (extend it to include userId) OR pass it as a prop from layout.

Simplest: Extend SocketProvider to accept a userId prop from the server layout and include it in context. Update src/lib/socket/provider.tsx to accept and expose userId. Update src/app/(app)/layout.tsx to pass userId={session.userId} to SocketProvider.

Changes to existing files:
- src/lib/socket/provider.tsx: Add userId to context value, accept as prop
- src/app/(app)/layout.tsx: Pass userId={session.userId} to SocketProvider
  </action>
  <verify>
`npm run build` passes.
Page imports useSocket correctly.
CreateRoomDialog emits room:create with settings.
Lobby page subscribes to room:list-update for real-time updates.
  </verify>
  <done>
Lobby page shows real-time room list via Socket.IO with room cards.
Create room dialog allows setting name, max players, turn timer, AFK threshold, visibility.
Joining a room navigates to /game/[roomId].
Empty state with helpful message when no rooms exist.
SocketProvider extended with userId for child components.
  </done>
</task>

</tasks>

<verification>
- `npm run build` passes
- Lobby page replaces placeholder with functional room browsing
- Room cards display all required info (name, players, status, host)
- Create room dialog has all settings fields
- Socket events used: room:list, room:create, room:join, room:list-update
- Navigation to /game/[roomId] on join/create
- Empty state displays properly
- German translations used for all labels
</verification>

<success_criteria>
- src/app/(app)/page.tsx is a functional lobby (not placeholder)
- Room cards show in responsive grid with real-time updates
- Create room dialog validates input and creates via Socket.IO
- Join button navigates to game room page
- All UI text in German using de.json translations
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-game-engine/02-06-SUMMARY.md`
</output>
