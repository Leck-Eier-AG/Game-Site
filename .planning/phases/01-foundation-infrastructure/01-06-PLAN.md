---
phase: 01-foundation-infrastructure
plan: 06
type: execute
wave: 1
depends_on: []
files_modified:
  - src/app/page.tsx
  - src/components/admin/invite-dialog.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Authenticated user navigating to / sees the app shell with sidebar, not the placeholder"
    - "Unauthenticated user navigating to / is redirected to /login"
    - "Invite dialog opens when clicking the invite button on admin dashboard"
    - "Invite dialog closes and resets state when dismissed"
  artifacts:
    - path: "src/app/(app)/page.tsx"
      provides: "Root page served through (app) route group layout"
    - path: "src/components/admin/invite-dialog.tsx"
      provides: "Working invite dialog with correct open/close behavior"
  key_links:
    - from: "/ route"
      to: "src/app/(app)/layout.tsx"
      via: "Next.js route group resolution (no competing src/app/page.tsx)"
      pattern: "Sidebar.*user"
    - from: "DialogTrigger click"
      to: "Dialog open state"
      via: "onOpenChange callback respecting boolean argument"
      pattern: "onOpenChange.*setOpen"
---

<objective>
Fix three UAT failures from Phase 1 verification: root page placeholder shadowing the app shell, and invite dialog refusing to open.

Purpose: These two code issues block 3 UAT tests (login flow, sidebar visibility, invite creation) and cascade-block 3 more skipped tests. Fixing them unblocks the entire Phase 1 verification.
Output: Working root route through (app) layout, working invite dialog.
</objective>

<execution_context>
@C:\Users\maxi\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\maxi\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-infrastructure/01-UAT.md

Key files:
@src/app/page.tsx (to be deleted)
@src/app/(app)/page.tsx (should become the root page)
@src/app/(app)/layout.tsx (app shell with sidebar)
@src/components/admin/invite-dialog.tsx (dialog bug)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Delete root page placeholder to fix app shell routing</name>
  <files>src/app/page.tsx</files>
  <action>
Delete the file `src/app/page.tsx` entirely.

This placeholder page was created during initial scaffolding and shows "Kniff - Deutsche Spieleseite - Coming Soon". It shadows `src/app/(app)/page.tsx` because Next.js serves a root-level page.tsx over a route-group page.tsx for the same path.

Once deleted, the `/` route will resolve through `src/app/(app)/layout.tsx` (which renders the Sidebar, MobileSidebar, and SocketProvider) and `src/app/(app)/page.tsx` (which shows the lobby placeholder).

Do NOT create a redirect file or any replacement. Just delete the file.
  </action>
  <verify>
1. Run `ls src/app/page.tsx` -- should return "No such file or directory"
2. Run `npx next build` (or `npm run build`) -- build should succeed without errors
3. Confirm `src/app/(app)/page.tsx` still exists and exports LobbyPage
  </verify>
  <done>
- `src/app/page.tsx` does not exist
- Build succeeds
- Navigating to `/` as an authenticated user would serve (app)/layout.tsx with sidebar (verified structurally; full flow verified in UAT re-test)
- Navigating to `/` as unauthenticated user would redirect to /login via middleware (no code change needed, middleware already handles this)
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix invite dialog onOpenChange to respect boolean argument</name>
  <files>src/components/admin/invite-dialog.tsx</files>
  <action>
In `src/components/admin/invite-dialog.tsx`, the Dialog's `onOpenChange` prop is set to `handleClose` (line 83), which unconditionally calls `setOpen(false)`. When the DialogTrigger fires `onOpenChange(true)`, the handler ignores the `true` argument and sets open to `false` immediately, preventing the dialog from ever opening.

Fix by changing the `onOpenChange` handler on the Dialog component (line 83) to a function that respects the boolean argument:

```tsx
<Dialog open={open} onOpenChange={(value) => {
  if (value) {
    setOpen(true)
  } else {
    handleClose()
  }
}}>
```

This way:
- When DialogTrigger fires onOpenChange(true), the dialog opens
- When user clicks outside or presses Escape (onOpenChange(false)), handleClose runs and resets all state (email, generatedLink, copied)

Do NOT change the handleClose function itself -- it correctly resets state on close. Only change how onOpenChange calls it.
  </action>
  <verify>
1. Run `npm run build` -- build succeeds without type errors
2. Visually inspect the code: onOpenChange should check the boolean value, calling setOpen(true) for open and handleClose() for close
3. Confirm the handleClose function still resets email, generatedLink, copied, and open state
  </verify>
  <done>
- Dialog opens when clicking the invite button (onOpenChange(true) calls setOpen(true))
- Dialog closes and resets state when dismissed (onOpenChange(false) calls handleClose)
- No regressions in dialog content or invite creation flow
  </done>
</task>

</tasks>

<verification>
After both tasks complete:

1. `src/app/page.tsx` does not exist
2. `src/app/(app)/page.tsx` exists and exports LobbyPage
3. `src/components/admin/invite-dialog.tsx` has onOpenChange that respects the boolean argument
4. `npm run build` succeeds with no errors

These fixes address UAT tests 2, 3, and 6 directly, and unblock skipped tests 4, 7, and 9.
</verification>

<success_criteria>
- Root placeholder page deleted, `/` route resolves through (app) layout with sidebar
- Invite dialog opens on button click, closes with state reset on dismiss
- Build passes with no errors
- All 3 diagnosed UAT gaps are structurally resolved
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-infrastructure/01-06-SUMMARY.md`
</output>
