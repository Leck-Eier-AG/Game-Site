---
phase: 04-additional-games
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - src/types/game.ts
  - src/components/lobby/create-room-dialog.tsx
  - src/components/lobby/room-card.tsx
  - src/app/game/[roomId]/page.tsx
  - server.js
autonomous: true

must_haves:
  truths:
    - "Room creator can select game type (Kniffel, Blackjack, Roulette, Poker) when creating a room"
    - "Lobby room cards display the game type with appropriate icon"
    - "Server routes game actions to correct game handler based on room gameType"
    - "Game room page loads the correct game board component based on gameType"
  artifacts:
    - path: "src/types/game.ts"
      provides: "GameType union type and game-specific settings"
      contains: "GameType"
    - path: "src/components/lobby/create-room-dialog.tsx"
      provides: "Game type selector dropdown in room creation"
      contains: "gameType"
    - path: "server.js"
      provides: "Game type routing infrastructure"
      contains: "gameType"
  key_links:
    - from: "src/components/lobby/create-room-dialog.tsx"
      to: "server.js (room:create)"
      via: "Socket.IO emit with gameType in settings"
      pattern: "gameType"
    - from: "src/app/game/[roomId]/page.tsx"
      to: "game-specific board components"
      via: "Conditional rendering based on room.gameType"
      pattern: "gameType.*switch|gameType.*blackjack|gameType.*poker|gameType.*roulette"
---

<objective>
Add game type selection infrastructure so rooms can be created for Kniffel, Blackjack, Roulette, or Poker, and the UI routes to the correct game board.

Purpose: Before building individual games, the platform needs to support multiple game types in room creation, lobby display, and game room routing.
Output: GameType type, updated lobby with game selector, server routing skeleton, game room conditional rendering.
</objective>

<execution_context>
@C:\Users\maxi\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\maxi\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@src/types/game.ts
@src/components/lobby/create-room-dialog.tsx
@src/components/lobby/room-card.tsx
@src/app/game/[roomId]/page.tsx
@server.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add GameType to types and update lobby UI</name>
  <files>
    src/types/game.ts
    src/components/lobby/create-room-dialog.tsx
    src/components/lobby/room-card.tsx
  </files>
  <action>
    1. In `src/types/game.ts`:
       - Add: `export type GameType = 'kniffel' | 'blackjack' | 'roulette' | 'poker'`
       - Update `RoomSettings` interface: change or add `gameType: GameType` field (currently hardcoded to 'kniffel' in server)
       - Update `RoomInfo` interface: ensure `gameType` field uses `GameType` type instead of `string`
       - Add game-specific settings types (prepare for later):
         ```typescript
         export interface PokerSettings {
           startingBlinds: number
           blindEscalation: boolean
           blindInterval: number // minutes
           allowRebuys: boolean
           rebuyLimit: number
           minBuyIn: number
           maxBuyIn: number
         }
         export interface BlackjackSettings {
           maxHands: number // 1-3 for solo multi-hand
         }
         export interface RouletteSettings {
           spinTimerSec: number // 0 = manual trigger
         }
         ```
       - Add to RoomSettings: `pokerSettings?: PokerSettings`, `blackjackSettings?: BlackjackSettings`, `rouletteSettings?: RouletteSettings`

    2. In `src/components/lobby/create-room-dialog.tsx`:
       - Add `gameType` state (default: 'kniffel')
       - Add game type selector as the FIRST field in the form: a `Select` dropdown with options:
         - Kniffel (üé≤ Kniffel)
         - Blackjack (üÉè Blackjack)
         - Roulette (üé∞ Roulette)
         - Poker (‚ô† Poker)
       - Include `gameType` in the settings sent to `room:create` socket event
       - Conditionally show game-specific settings based on gameType:
         - Kniffel: existing settings (maxPlayers 2-6, turnTimer, afkThreshold)
         - Blackjack: maxPlayers 1-7 (solo or multiplayer), no turnTimer for now
         - Roulette: maxPlayers 1-10, spin timer dropdown (15s, 30s, 60s, or manual)
         - Poker: maxPlayers 2-9, blind settings (starting blind amount), rebuy toggle
       - Keep bet room settings visible for all game types

    3. In `src/components/lobby/room-card.tsx`:
       - Display game type icon/badge on room card (use emoji or lucide icons):
         - Kniffel: Dice icon
         - Blackjack: diamond/card icon
         - Roulette: circle-dot icon
         - Poker: Spade icon
       - Show game type label in German: "Kniffel", "Blackjack", "Roulette", "Poker"
  </action>
  <verify>
    - `npm run build` succeeds
    - TypeScript compiles without errors for new GameType usage
  </verify>
  <done>Room creation dialog shows game type selector, lobby cards display game type, GameType type is defined</done>
</task>

<task type="auto">
  <name>Task 2: Add game-type routing in server and game room page</name>
  <files>
    server.js
    src/app/game/[roomId]/page.tsx
  </files>
  <action>
    1. In `server.js`:
       - Update `createRoom` method: accept and store `gameType` from settings (default: 'kniffel')
       - Store game-specific settings in room object: `pokerSettings`, `blackjackSettings`, `rouletteSettings`
       - Update `getPublicRooms()` to include `gameType` in room list data
       - In `game:start` handler, branch on `room.gameType`:
         - 'kniffel': existing createInitialState logic (unchanged)
         - 'blackjack': placeholder ‚Äî `room.gameState = { phase: 'betting', gameType: 'blackjack' }` (will be replaced by actual state machine in Plan 04-03)
         - 'roulette': placeholder ‚Äî `room.gameState = { phase: 'betting', gameType: 'roulette' }` (will be replaced in Plan 04-04)
         - 'poker': placeholder ‚Äî `room.gameState = { phase: 'waiting', gameType: 'poker' }` (will be replaced in Plan 04-05)
       - In game action handlers (game:roll-dice, game:choose-category), guard with `if (room.gameType !== 'kniffel')` checks
       - Add placeholder game action handlers that will be filled in by later plans:
         - `game:blackjack-action` ‚Äî returns error "Not yet implemented"
         - `game:roulette-action` ‚Äî returns error "Not yet implemented"
         - `game:poker-action` ‚Äî returns error "Not yet implemented"

    2. In `src/app/game/[roomId]/page.tsx`:
       - Add gameType to room state (read from room data)
       - In the render section, switch on gameType:
         - 'kniffel': render existing GameBoard (unchanged)
         - 'blackjack': render placeholder `<div>Blackjack - Kommt bald</div>` (will be replaced)
         - 'roulette': render placeholder `<div>Roulette - Kommt bald</div>` (will be replaced)
         - 'poker': render placeholder `<div>Poker - Kommt bald</div>` (will be replaced)
       - The WaitingRoom component should work for all game types (it's game-agnostic)
  </action>
  <verify>
    - `npm run build` succeeds
    - Creating a room with different game types stores correct gameType
    - Kniffel games continue to work exactly as before
  </verify>
  <done>Server stores gameType per room, game room page routes to correct board component, existing Kniffel functionality is preserved, placeholder handlers exist for new games</done>
</task>

</tasks>

<verification>
- Room creation includes game type selection
- Room cards in lobby show game type
- Server correctly stores and broadcasts gameType
- Kniffel gameplay is completely unaffected
- Game room page conditionally renders based on gameType
- npm run build succeeds
</verification>

<success_criteria>
- GameType union type exists with all four games
- Lobby room creation has game type dropdown
- Room cards display game type with icon
- Server accepts and stores gameType per room
- Game room page routes to correct board component
- All existing Kniffel functionality preserved (regression-free)
</success_criteria>

<output>
After completion, create `.planning/phases/04-additional-games/04-02-SUMMARY.md`
</output>
