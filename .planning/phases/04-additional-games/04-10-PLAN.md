---
phase: 04-additional-games
plan: 10
type: execute
wave: 5
depends_on: [04-01, 04-09]
files_modified:
  - src/components/poker/PokerTable.tsx
  - src/components/poker/PlayerSeat.tsx
  - src/components/poker/CommunityCards.tsx
  - src/components/poker/PotDisplay.tsx
  - src/components/poker/BettingControls.tsx
  - src/app/game/[roomId]/page.tsx
autonomous: true

must_haves:
  truths:
    - "Poker table renders oval felt with 9 seat positions"
    - "Each player seat shows avatar, chip count, current bet, and cards (face-down for opponents)"
    - "Community cards display flop/turn/river with dealing animations"
    - "Pot display shows main pot and side pots"
    - "Betting controls show fold/check/call/raise with raise slider"
    - "Showdown reveals all remaining players' cards with hand names"
  artifacts:
    - path: "src/components/poker/PokerTable.tsx"
      provides: "Main poker table with oval layout"
    - path: "src/components/poker/PlayerSeat.tsx"
      provides: "Individual player seat with cards and chips"
    - path: "src/components/poker/CommunityCards.tsx"
      provides: "Flop/turn/river community card display"
    - path: "src/components/poker/PotDisplay.tsx"
      provides: "Main pot and side pot display"
    - path: "src/components/poker/BettingControls.tsx"
      provides: "Fold/check/call/raise action bar with raise amount"
  key_links:
    - from: "src/app/game/[roomId]/page.tsx"
      to: "src/components/poker/PokerTable.tsx"
      via: "Renders PokerTable when gameType is 'poker'"
      pattern: "PokerTable"
    - from: "src/components/poker/BettingControls.tsx"
      to: "Socket.IO poker:action"
      via: "Emits player actions to server"
      pattern: "poker:action"
---

<objective>
Build the Poker UI components with the signature oval table layout, 9 fixed seat positions, community cards, and betting controls.

Purpose: Poker requires the most complex UI of all games — an oval table with players arranged around it, community cards in the center, per-player chip stacks, and a betting control bar with raise slider.
Output: Complete poker UI integrated into the game room page.
</objective>

<execution_context>
@C:\Users\maxi\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\maxi\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/04-additional-games/04-CONTEXT.md
@src/lib/game/poker/state-machine.ts
@src/components/casino/Card.tsx
@src/components/casino/FeltTable.tsx
@src/components/casino/ChipStack.tsx
@src/app/game/[roomId]/page.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Build Poker table layout and player seats</name>
  <files>
    src/components/poker/PokerTable.tsx
    src/components/poker/PlayerSeat.tsx
    src/components/poker/CommunityCards.tsx
    src/components/poker/PotDisplay.tsx
  </files>
  <action>
    1. Create `src/components/poker/PokerTable.tsx`:
       - Props: { gameState: PokerGameState; roomId: string; currentUserId: string; socket: Socket; isBetRoom?: boolean }
       - Layout: FeltTable (variant='blue' for poker) with oval shape
       - 9 fixed seat positions arranged around the oval using CSS absolute positioning:
         - Position 0: bottom center (current player always here)
         - Positions 1-8: clockwise around the table
         - Rotate seat assignments so current user is always at bottom
       - Center area: community cards + pot display
       - Dealer button indicator (small 'D' chip) next to dealer seat
       - Small blind ('SB') and big blind ('BB') indicators
       - Current turn indicator: highlight active player's seat
       - Phase label: "Preflop", "Flop", "Turn", "River", "Showdown"
       - BettingControls at bottom when it's current user's turn
       - Show action timer countdown for current player
       - GameChat integrated

    2. Create `src/components/poker/PlayerSeat.tsx`:
       - Props: { player: PokerPlayer; isDealer: boolean; isSmallBlind: boolean; isBigBlind: boolean; isActive: boolean; isCurrentUser: boolean; showCards: boolean; position: number }
       - Display: avatar circle with displayName, chip count below
       - Two hole cards: face-up for current user, face-down for others, revealed on showdown
       - Current bet displayed as ChipStack in front of seat
       - Status indicators: folded (dimmed + "Gepasst"), all-in ("All-In" badge), sitting out ("Pause")
       - Active turn: golden ring around seat, subtle pulse animation
       - Dealer/SB/BB badges: small circular indicators

    3. Create `src/components/poker/CommunityCards.tsx`:
       - Props: { cards: Card[]; phase: string }
       - Display 0-5 community cards in center of table
       - Dealing animation: cards slide in from deck position
       - Flop: 3 cards dealt simultaneously with slight stagger
       - Turn/River: single card dealt next to existing
       - Cards face-up with SVG rendering via Card component

    4. Create `src/components/poker/PotDisplay.tsx`:
       - Props: { mainPot: number; sidePots?: { amount: number; eligibleCount: number }[] }
       - Center of table, above community cards
       - Main pot: large ChipStack with amount label
       - Side pots: smaller stacks to the side with "Nebentopf" label and eligible player count
       - Animated amount changes (count-up on pot increase)
  </action>
  <verify>
    - `npm run build` succeeds
    - PokerTable renders oval layout with seat positions
    - PlayerSeat shows cards face-down for opponents
  </verify>
  <done>Poker table renders with 9 seats around oval, player seats show cards/chips/status, community cards display with dealing animation, pot display shows main and side pots</done>
</task>

<task type="auto">
  <name>Task 2: Build betting controls and wire into game room page</name>
  <files>
    src/components/poker/BettingControls.tsx
    src/app/game/[roomId]/page.tsx
  </files>
  <action>
    1. Create `src/components/poker/BettingControls.tsx`:
       - Props: { availableActions: string[]; currentBet: number; playerBet: number; playerChips: number; minRaise: number; pot: number; onAction: (action, amount?) => void; disabled: boolean; timeLeft?: number }
       - Fixed bar at bottom of poker table
       - Action buttons (German labels):
         - "Passen" (Fold) — always available when it's your turn
         - "Schieben" (Check) — only when no bet to match
         - "Mitgehen" (Call) — shows call amount, e.g., "Mitgehen (50)"
         - "Erhöhen" (Raise) — opens raise amount selector
         - "All-In" — bet all remaining chips
       - Raise amount control:
         - Slider from minRaise to playerChips
         - Quick buttons: Min Raise, 1/2 Pot, 3/4 Pot, Pot, All-In
         - Number input for exact amount
       - Timer bar: visual countdown for action timer (30s default)
       - Disable all buttons when not player's turn
       - Responsive: buttons stack vertically on mobile

    2. In `src/app/game/[roomId]/page.tsx`:
       - Import PokerTable
       - Replace poker placeholder with PokerTable component
       - Pass gameState, roomId, currentUserId, socket, isBetRoom props
       - Handle poker-specific socket events:
         - `poker:showdown` — trigger card reveal animations
         - `poker:hand-end` — show hand results briefly
         - `poker:rebuy-available` — show rebuy prompt between hands
       - Add rebuy dialog: modal that appears when player is out of chips between hands
       - Show "Spiel beendet" (Game Over) screen when host ends game, with final chip counts converted to balance
  </action>
  <verify>
    - `npm run build` succeeds
    - Poker renders in game room when gameType is 'poker'
    - Betting controls show correct actions
  </verify>
  <done>BettingControls show fold/check/call/raise with raise slider, game room page renders PokerTable for poker games, rebuy dialog and game-over screen integrated</done>
</task>

</tasks>

<verification>
- Poker table renders with correct seat layout
- Current user always at bottom position
- Hole cards hidden for opponents, shown for self
- Community cards display with dealing animation
- Betting controls show available actions
- Raise slider works with quick buttons (1/2 pot, pot, etc.)
- Pot display shows main + side pots
- Showdown reveals all cards
- npm run build succeeds
</verification>

<success_criteria>
- Oval poker table with 9 fixed seat positions
- Player seats display cards, chips, and status correctly
- Community cards deal with staggered animation
- Betting controls provide full action set with raise amount
- Pot display shows main pot and side pots
- Showdown reveals cards with hand names in German
- Game room page routes poker games to PokerTable
- Responsive layout works on mobile
</success_criteria>

<output>
After completion, create `.planning/phases/04-additional-games/04-10-SUMMARY.md`
</output>
