---
phase: 04-additional-games
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - src/lib/game/cards/types.ts
  - src/lib/game/cards/deck.ts
  - src/components/casino/Card.tsx
  - src/components/casino/CardBack.tsx
  - src/components/casino/FeltTable.tsx
  - src/components/casino/ChipStack.tsx
  - src/components/casino/SoundManager.tsx
  - src/components/casino/casino-animations.css
autonomous: true

must_haves:
  truths:
    - "Card type system supports standard 52-card deck with ranks and suits"
    - "Deck creation and Fisher-Yates CSPRNG shuffle produce unbiased random decks"
    - "SVG Card component renders face-up and face-down cards with flip animation"
    - "FeltTable wrapper renders classic casino green felt with wood border and gold accents"
    - "ChipStack displays colored chip denominations visually"
    - "SoundManager plays casino sounds (card flip, chip clink, etc.) with mute toggle"
  artifacts:
    - path: "src/lib/game/cards/types.ts"
      provides: "Card, Rank, Suit type definitions for all card games"
      exports: ["Card", "Rank", "Suit", "RANKS", "SUITS"]
    - path: "src/lib/game/cards/deck.ts"
      provides: "Deck creation and cryptographic shuffle"
      exports: ["createDeck", "createMultiDeck", "shuffleDeck"]
    - path: "src/components/casino/Card.tsx"
      provides: "SVG playing card with flip animation"
    - path: "src/components/casino/FeltTable.tsx"
      provides: "Reusable casino felt table wrapper"
    - path: "src/components/casino/ChipStack.tsx"
      provides: "Visual chip stack with denominations"
    - path: "src/components/casino/SoundManager.tsx"
      provides: "Casino sound effects provider and hook"
  key_links:
    - from: "src/lib/game/cards/deck.ts"
      to: "src/lib/game/crypto-rng.ts"
      via: "Uses node:crypto randomInt for shuffle"
      pattern: "randomInt"
    - from: "src/components/casino/Card.tsx"
      to: "@mudont/react-ts-svg-playing-cards"
      via: "SVG card rendering"
      pattern: "import.*svg-playing-cards"
---

<objective>
Install shared casino dependencies and build the foundation layer used by all three games (Poker, Blackjack, Roulette).

Purpose: Card types, deck utilities, and reusable casino UI components are shared across all three games. Building them first unblocks parallel game development.
Output: Card type system, CSPRNG deck shuffle, SVG card component with animations, casino felt table, chip stacks, and sound manager.
</objective>

<execution_context>
@C:\Users\maxi\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\maxi\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-additional-games/04-RESEARCH.md
@src/lib/game/crypto-rng.ts
@src/types/game.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install dependencies and create card type system with deck utilities</name>
  <files>
    package.json
    src/lib/game/cards/types.ts
    src/lib/game/cards/deck.ts
  </files>
  <action>
    1. Install casino game dependencies:
       ```
       npm install poker-evaluator-ts engine-blackjack @dnd-kit/core @dnd-kit/sortable
       ```
       Note: Skip @mudont/react-ts-svg-playing-cards — build custom SVG cards instead (more control over styling, no dependency risk). Use inline SVG with standard card designs.

    2. Create `src/lib/game/cards/types.ts`:
       - Export type `Rank = '2' | '3' | '4' | '5' | '6' | '7' | '8' | '9' | '10' | 'J' | 'Q' | 'K' | 'A'`
       - Export type `Suit = 'hearts' | 'diamonds' | 'clubs' | 'spades'`
       - Export interface `Card { rank: Rank; suit: Suit }`
       - Export const `RANKS: Rank[]` and `SUITS: Suit[]` arrays
       - Export const `SUIT_SYMBOLS: Record<Suit, string>` mapping to Unicode symbols (♠♥♦♣)
       - Export const `SUIT_COLORS: Record<Suit, 'red' | 'black'>` for rendering
       - Export type `Hand = Card[]`

    3. Create `src/lib/game/cards/deck.ts`:
       - Import `randomInt` from `node:crypto` (same pattern as existing crypto-rng.ts)
       - Import Card, RANKS, SUITS from types
       - `createDeck(): Card[]` — standard 52-card deck
       - `createMultiDeck(count: number): Card[]` — multiple decks combined (for blackjack 6-deck shoe)
       - `shuffleDeck(deck: Card[]): Card[]` — Fisher-Yates with crypto.randomInt, returns new array (pure function)
       - `dealCards(deck: Card[], count: number): { dealt: Card[]; remaining: Card[] }` — deal from top of deck
  </action>
  <verify>
    - `npx tsx -e "import { createDeck, shuffleDeck } from './src/lib/game/cards/deck'; const d = shuffleDeck(createDeck()); console.log(d.length, d[0])"` prints 52 and a card object
    - TypeScript compiles without errors
  </verify>
  <done>Card type system with Rank/Suit/Card types exists, deck creation and CSPRNG shuffle work correctly, multi-deck support for blackjack shoe</done>
</task>

<task type="auto">
  <name>Task 2: Build reusable casino UI components</name>
  <files>
    src/components/casino/Card.tsx
    src/components/casino/CardBack.tsx
    src/components/casino/FeltTable.tsx
    src/components/casino/ChipStack.tsx
    src/components/casino/SoundManager.tsx
    src/components/casino/casino-animations.css
  </files>
  <action>
    1. Create `src/components/casino/Card.tsx`:
       - Props: `{ rank: Rank; suit: Suit; faceDown?: boolean; isDealing?: boolean; className?: string; size?: 'sm' | 'md' | 'lg' }`
       - Render card face using inline SVG: white background, rank+suit in corners, large center suit symbol
       - Red for hearts/diamonds, black for clubs/spades
       - CSS 3D flip animation via `perspective` and `rotateY(180deg)` for faceDown toggle
       - Deal animation class with arc motion via CSS keyframes
       - Size variants: sm (60x84), md (80x112), lg (100x140)

    2. Create `src/components/casino/CardBack.tsx`:
       - Classic crosshatch/diamond pattern using SVG pattern fill
       - Dark blue/red background with repeating diamond motif
       - Rounded corners matching Card component

    3. Create `src/components/casino/FeltTable.tsx`:
       - Props: `{ children: ReactNode; className?: string; variant?: 'green' | 'blue' | 'red' }`
       - Outer div: rounded-[2rem], wood border (border-[12px] border-amber-900), shadow-2xl
       - Inner div: green felt gradient (from-green-800 to-green-900) with subtle texture overlay
       - Gold accent border line (border-2 border-yellow-600/30)
       - Green variant default, blue for poker, red for roulette accents

    4. Create `src/components/casino/ChipStack.tsx`:
       - Props: `{ amount: number; size?: 'sm' | 'md' | 'lg'; showLabel?: boolean }`
       - Break amount into chip denominations: 1 (white), 5 (red), 25 (green), 100 (black), 500 (purple), 1000 (gold)
       - Render stacked circular chips with 3D shadow effect (offset each by 2px vertically)
       - Show amount label below if showLabel is true
       - Each chip: rounded-full with denomination-specific colors and edge stripe

    5. Create `src/components/casino/SoundManager.tsx`:
       - React context provider + hook: `useCasinoSound()`
       - Functions: `playCardFlip()`, `playCardDeal()`, `playChipClink()`, `playChipStack()`, `playWheelSpin()`, `playWin()`, `playLose()`
       - Use Web Audio API with AudioContext (lazy init on first user interaction)
       - Generate simple sounds procedurally (sine wave tones with envelopes) — no external audio files needed
       - Global mute state stored in localStorage, toggle via `toggleMute()`
       - Wrap in `'use client'` directive

    6. Create `src/components/casino/casino-animations.css`:
       - `@keyframes card-deal` — arc motion from dealer position to target
       - `@keyframes card-flip` — 3D Y-axis rotation
       - `@keyframes chip-slide` — smooth horizontal slide
       - `@keyframes chip-stack` — drop onto stack with slight bounce
       - `@keyframes wheel-spin` — continuous rotation with ease-out
       - Import this CSS in the casino components or in layout
  </action>
  <verify>
    - `npm run build` completes without TypeScript errors
    - All casino component files exist and export their components
  </verify>
  <done>SVG Card renders face-up and face-down with flip animation, FeltTable provides casino felt wrapper with wood border and gold accents, ChipStack shows colored denomination chips, SoundManager provides procedural casino sounds with mute toggle</done>
</task>

</tasks>

<verification>
- Card types compile and deck utilities produce correct 52-card decks
- Multi-deck creates correct number of cards (312 for 6 decks)
- Shuffle produces different orderings (run twice, compare)
- All UI components export without errors
- npm run build succeeds
</verification>

<success_criteria>
- Card type system (Rank, Suit, Card) is fully typed and shared
- CSPRNG Fisher-Yates shuffle in deck.ts uses node:crypto
- SVG Card component renders all 52 cards face-up and face-down
- FeltTable provides consistent casino aesthetic for all games
- ChipStack displays chip denominations visually
- SoundManager provides casino sounds via Web Audio API
- All dependencies installed (poker-evaluator-ts, engine-blackjack, dnd-kit)
</success_criteria>

<output>
After completion, create `.planning/phases/04-additional-games/04-01-SUMMARY.md`
</output>
